{% extends "base.html" %}

{% block head %}
    <title>Meus Eventos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style/events.css') }}">
{% endblock head %}

{% block content %}
<div class="main-content">

    <div class="header">
        {% include "components/flash.html"%}
        <h1>Meus Eventos</h1>

        <div class="botoes">
            <a href="{{ url_for('user.user') }}"><button class="add-event-btn">Perfil</button></a>
            <!-- BOTÃO QUE ABRE O MODAL -->
            <button class="add-event-btn enhanced-btn" id="openModalBtn">
                <i class="fas fa-plus"></i> Adicionar Evento
            </button>

            <form action="{{ url_for('auth.logout') }}" method="POST">
                <button class="add-event-btn" type="submit">Logout</button>
            </form>
        </div>
    </div>

    {% if datas %}
    <div class="events-grid extra-margin">

        {% for data in datas %}
        <article class="event-card" role="article" aria-labelledby="ev-{{ data.id }}-title">

            <header>
                <div id="ev-{{ data.id }}-title" class="event-title">{{ data.titulo_evento }}</div>

                <div class="event-type">
                    Tipo: 
                    <strong>{{ data.tipo_evento }}</strong>
                </div>
            </header>

            <div class="event-main">
                <div class="event-date 
                    {% if data.relevancia == 'Alta' %}date-high 
                    {% elif data.relevancia == 'Média' %}date-medium
                    {% else %}date-low{% endif %}
                ">
                    {{ data.data.strftime('%d/%m/%Y') }}
                </div>

                <div class="event-meta">
                    <div class="event-relevance">
                        {% if data.relevancia == "Alta" %}
                            <span class="badge badge-high">Relevância: Alta</span>
                        {% elif data.relevancia == "Média" %}
                            <span class="badge badge-medium">Relevância: Média</span>
                        {% else %}
                            <span class="badge badge-low">Relevância: Baixa</span>
                        {% endif %}
                    </div><br>
                </div>
            </div>

            <footer class="event-buttons">
                <a href="{{ url_for('events.events_edit', event_id=data.id) }}" class="btn-edit">Editar</a>

                <form method="POST" action="{{ url_for('events.events_delete', event_id=data.id) }}" 
                      onsubmit="return confirm('Tem certeza que deseja excluir este evento?');">
                    <button type="submit" class="btn-delete">Excluir</button>
                </form>
            </footer>

        </article>
        {% endfor %}

    </div>

    {% else %}
    <div class="no-events">
        <i class="fas fa-calendar-times fa-3x"></i>
        <h3>Nenhum evento cadastrado</h3>
        <p>Comece adicionando seu primeiro evento acadêmico!</p>

        <button class="add-event-btn enhanced-btn" id="openModalBtn">
            <i class="fas fa-plus"></i> Adicionar Primeiro Evento
        </button>
    </div>
    {% endif %}
</div>

<!-- ========================= -->
<!-- MODAL DE ADICIONAR EVENTO -->
<!-- ========================= -->

<div id="eventModal" class="modal-overlay">
    <div class="modal-container">

        <h2 class="modal-title">Adicionar Evento</h2>

        <form method="POST" action="{{ url_for('events.events_add') }}" class="modal-form">

            <input type="text" name="titulo_evento" placeholder="Título do evento" required>

            <input type="date" name="data" required>

            <!-- TIPOS DE EVENTOS -->
            <select name="tipo_evento_id" required>
                <option value="" disabled selected>Tipo do evento</option>
                {% for tipo in tipo_eventos %}
                    <option value="{{ tipo.id }}">{{ tipo.nome }}</option>
                {% endfor %}
            </select>

            <!-- RELEVÂNCIA -->
            <select name="relevancia_id" required>
                <option value="" disabled selected>Relevância</option>
                {% for nivel in niveis_relevancia %}
                    <option value="{{ nivel.id }}">{{ nivel.nivel }}</option>
                {% endfor %}
            </select>

            <div class="modal-buttons">
                <button type="button" class="btn-cancel" id="closeModalBtn">Cancelar</button>
                <button type="submit" class="btn-submit">Salvar</button>
            </div>

        </form>
    </div>
</div>

<script>
    const modal = document.getElementById("eventModal");
    const openBtns = document.querySelectorAll("#openModalBtn");
    const closeBtn = document.getElementById("closeModalBtn");

    openBtns.forEach(btn => {
        btn.addEventListener("click", () => {
            modal.style.display = "flex";
        });
    });

    closeBtn.addEventListener("click", () => {
        modal.style.display = "none";
    });

    window.addEventListener("click", (e) => {
        if (e.target === modal) {
            modal.style.display = "none";
        }
    });
</script>

{% endblock %}
